<%= stylesheet_link_tag "dashboard_groups", :media => "all" %>
<input type="hidden" id="org_id" value="<%=cookies[:org_id]%>" />
<input type="hidden" id="user_id" value="<%=cookies[:user_id]%>" />
<input type="hidden" id="is_root" value="<%=cookies[:is_root]%>" />
<input type="hidden" id="is_admin" value="<%=cookies[:is_admin]%>" />
<input type="hidden" id="admin_location" value="<%=cookies[:user_location_id]%>" />
<input type="hidden" id="api_key" value="<%=cookies[:api_key]%>" />
<input type="hidden" id="asset_root" value="<%=ENV['ASSET_ROOT']%>" />
<div class="page-content">

  <!-- BEGIN CONFIRM DELETE GROUP MODAL -->
  <div id="confirm_delete_group_modal" class="modal fade" data-backdrop="static" tabindex="-1" data-focus-on="input:first">
    <div class="modal-header">
      <button type="button" class="close" data-dismiss="modal" aria-hidden="true"></button>
      <h4 class="modal-title">Are You Sure?</h4>
    </div>
    <div class="modal-body">
      <p>If there are users currently assigned to this user group, deleting it will cause them to become unassigned.</p>
    </div>  
    <div class="modal-footer">
      <button type="button" class="btn blue" onclick="GroupsModule.deleteGroup();">Confirm</button>
      <button type="button" class="btn default" data-dismiss="modal">Close</button>
    </div>
  </div>
  <!-- END CONFIRM DELETE GROUP MODAL -->
  <!-- END NEW LOCATION MODAL -->

  <!-- BEGIN NEW GROUP MODAL -->
  <div id="new_group_modal" class="modal fade" data-backdrop="static" tabindex="-1" data-focus-on="input:first">
    <div class="modal-header">
      <button type="button" class="close" data-dismiss="modal" aria-hidden="true"></button>
      <h4 class="modal-title"><%=ENV_VARS['messages']['menu7']['modal1Title']%></h4>
    </div>
    <div class="modal-body">
      <div class="row">
        <div class="col-md-12">
          <div class="form-group">
            <p>
              <span class="label label-danger">
              <%=ENV_VARS['messages']['menu7']['modal1InfoMessage1']%> </span>
              &nbsp; <%=ENV_VARS['messages']['menu7']['modal1InfoMessage2']%>
            </p>
            <form action="/api/images/drop_image" class="dropzone" id="group-avatar-dropzone">
              <input type="hidden" id="image_type" name="image[image_type]" value="6" />
              <input type="hidden" id="image_org" name="image[org_id]" value="<%= cookies[:org_id]%>" />
              <input type="hidden" id="owner_id" name="image[owner_id]" value="<%= cookies[:user_id]%>" />
              <input type="hidden" id="is_valid" name="image[is_valid]" value="true" />
            </form>
          </div>
        </div>
      </div>
<form class="new-group-form" method="POST">
      <input type="hidden" value="" id="group_avatar_id" name="groupavatarid" />
      <div class="row">
        <div class="col-md-12">
          <div class="form-group">
            <label class="control-label visible-ie8 visible-ie9"><%=ENV_VARS['messages']['menu7']['modal1IEText1']%></label>
            <input class="form-control placeholder-no-fix" type="text" placeholder="<%=ENV_VARS['messages']['menu7']['modal1PlaceholderText1']%>" id="group_name" name="groupname" />
          </div>
          <div class="form-group">
            <label class="control-label visible-ie8 visible-ie9"><%=ENV_VARS['messages']['menu7']['modal1IEText2']%></label>
            <textarea class="form-control placeholder-no-fix" rows="3" placeholder="<%=ENV_VARS['messages']['menu7']['modal1PlaceholderText2']%>" id="group_description" name="groupdescription"></textarea>
          </div>
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <div class="form-actions">
        <button type="submit" class="btn btn-success"><%=ENV_VARS['messages']['menu7']['modal1ButtonText1']%></button>
        <button type="button" class="btn default" data-dismiss="modal"><%=ENV_VARS['messages']['menu7']['modal1ButtonText2']%></button>
      </div>
    </div>
</form>
  </div>
  <!-- /.modal -->
  <!-- END NEW GROUP MODAL -->

  <!-- BEGIN STYLE CUSTOMIZER -->
  
  <!-- END STYLE CUSTOMIZER -->
  <!-- BEGIN PAGE HEADER-->
  
  <!-- END PAGE HEADER-->
  <!-- BEGIN PAGE CONTENT-->
  <div class="row main-content-div" style="min-height: 500px;">
    <div class="col-md-12">
      <!-- BEGIN Portlet PORTLET-->
      <div class="portlet light" id="tabs">
        <ul class="nav nav-tabs nav-justified">
          <li class="disabled">
            <a href="#tab_groups" data-toggle="tab" class="uppercase bold">
            <i class="icon-users"></i> <%=ENV_VARS['messages']['menu7']['tabTitle1']%></a>
          </li>
        </ul>
        <div class="portlet-body">
          <div class="tab-content">
            <!-- <div class="tab-pane active" id="tab_users"> -->
            <div class="tab-pane" id="tab_users">
              <!-- BEGIN EXAMPLE TABLE PORTLET-->
              <div class="portlet full-height-content full-height-content-scrollable">
                <div class="portlet-title">
                  <div class="actions">
                    <a href="#upload_user_select_modal" data-toggle="modal" class="btn btn-sm green">
                    <i class="fa fa-plus"></i> New </a>
                    <div class="btn-group">
                      <a class="btn btn-sm blue" href="#" data-toggle="dropdown">
                      <i class="fa fa-cogs"></i> Bulk Actions <i class="fa fa-angle-down"></i>
                      </a>
                      <ul class="dropdown-menu pull-right">
                        <li>
                          <a href="#" onclick="GroupsModule.editUsers();">
                          <i class="fa fa-pencil"></i> Edit </a>
                        </li>
                        <li>
                          <a href="#" onclick="GroupsModule.banUsers();">
                          <i class="fa fa-ban"></i> Ban </a>
                        </li>
                      </ul>
                    </div>
                  </div>
                </div>
                <div class="portlet-body">
                  <div class="full-height-content-body">
                    <table class="table table-striped row-bordered table-hover" id="user_table">
                      <thead>
                        <tr>
                          <th class="table-checkbox">
                            <input onclick="GroupsModule.toggleAll(this);" id="select_all_users" type="checkbox" class="group-checkable" data-set="#user_table_body"/>
                          </th>
                          <th>
                          </th>
                          <th>
                             Name
                          </th>
                          <th>
                             Email
                          </th>
                          <th>
                             Phone
                          </th>
                          <th>
                             Group
                          </th>
                          <th>
                             Location
                          </th>
                          <th>
                             Status
                          </th>
                        </tr>
                      </thead>
                      <tbody id="user_table_body">
                      
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
              <!-- END EXAMPLE TABLE PORTLET-->
            </div>
            <div class="tab-pane" id="tab_invitations">
              <!-- BEGIN EXAMPLE TABLE PORTLET-->
              <div class="portlet full-height-content full-height-content-scrollable">
                <div class="portlet-title">
                  <div class="actions">
                    <a href="#upload_user_select_modal" data-toggle="modal" class="btn btn-sm green">
                    <i class="fa fa-plus"></i> New </a>
                    <div class="btn-group">
                      <a class="btn btn-sm blue" href="#" data-toggle="dropdown">
                      <i class="fa fa-cogs"></i> Bulk Actions <i class="fa fa-angle-down"></i>
                      </a>
                      <ul class="dropdown-menu pull-right">
                        <li>
                          <a href="#" onclick="GroupsModule.editInvitees();">
                          <i class="fa fa-pencil"></i> Edit </a>
                        </li>
                        <li>
                          <a href="#" onclick="GroupsModule.deleteInvitees();">
                          <i class="fa fa-ban"></i> Delete </a>
                        </li>
                    </div>
                  </div>
                </div>
                <div class="portlet-body">
                  <div class="full-height-content-body">
                    <table class="table table-striped row-bordered table-hover" id="invitee_table">
                      <thead>
                        <tr>
                          <th class="table-checkbox">
                            <input id="select_all_invitees" onclick="GroupsModule.toggleAll(this);" type="checkbox" class="group-checkable" data-set="#invitee_table_body"/>
                          </th>
                          <th>
                          </th>
                          <th>
                             Name
                          </th>
                          <th>
                             Invited On
                          </th>
                          <th>
                             Email
                          </th>
                          <th>
                             Phone
                          </th>
                          <th>
                             Group
                          </th>
                          <th>
                             Location
                          </th>
                          <th>
                             Actions
                          </th>
                        </tr>
                        </thead>
                      <tbody id="invitee_table_body">
                      
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
              <!-- END EXAMPLE TABLE PORTLET-->
            </div>
            <!--<div class="tab-pane" id="tab_applications">
              <div class="portlet full-height-content full-height-content-scrollable">
                <div class="portlet-title">
                  <div class="caption">
                    <i class="fa fa-child"></i>Applications
                  </div>
                  <div class="actions">
                    <div class="btn-group">
                      <a class="btn btn-sm blue" href="#" data-toggle="dropdown">
                      <i class="fa fa-cogs"></i> Tools <i class="fa fa-angle-down"></i>
                      </a>
                      <ul class="dropdown-menu pull-right">
                        <li>
                          <a href="#" onclick="GroupsModule.editApplications();">
                          <i class="fa fa-pencil"></i> Edit </a>
                        </li>
                        <li>
                          <a href="#" onclick="GroupsModule.approveApplications();">
                          <i class="fa fa-check"></i> Approve </a>
                        </li>
                        <li>
                          <a href="#" onclick="GroupsModule.rejectApplications();">
                          <i class="fa fa-times"></i> Reject </a>
                        </li>
                      </ul>
                    </div>
                  </div>
                </div>
                <div class="portlet-body">
                  <div class="full-height-content-body">
                    <table class="table table-striped table-bordered table-hover" id="applicant_table">
                      <thead>
                        <tr>
                          <th class="table-checkbox">
                            <input onclick="GroupsModule.toggleAll(this);" id="select_all_applicants" type="checkbox" class="group-checkable" data-set="#applicant_table_body"/>
                          </th>
                          <th>
                          </th>
                          <th>
                             Name
                          </th>
                          <th>
                             Email
                          </th>
                          <th>
                             Phone
                          </th>
                          <th>
                             Group
                          </th>
                          <th>
                             Location
                          </th>
                          <th>
                             Status
                          </th>
                        </tr>
                      </thead>
                      <tbody id="applicant_table_body">
                      
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>-->
            <div class="tab-pane active" id="tab_groups">
              <div class="portlet">
                <div class="portlet-title">
                  <div class="actions">
                    <a href="#new_group_modal" data-toggle="modal" class="btn btn-sm green">
                      <i class="fa fa-plus"></i>
                      <%=ENV_VARS['messages']['menu7']['buttonMenuText1']%>
                    </a>
                  </div>
                </div>
                <div class="portlet-body">
                  <div class="row" id="group_portlets">
                    <!--DAVID: This is where javascript adds groups from DB -->

                    <div class="full-height-content-body">
                      <table class="table table-striped row-bordered table-hover" id="group_table">
                        <thead>
                          <tr>

                            <th>
                              <!-- DAVID: This column is for the id -->
                            </th>

                            <th>
                            <%=ENV_VARS['messages']['menu7']['table1Col1']%>
                            </th>

                            <th>
                            <%=ENV_VARS['messages']['menu7']['table1Col2']%>
                            </th>

                            <th>
                            <%=ENV_VARS['messages']['menu7']['table1Col3']%>
                            </th>

                            <th>
                              <!-- DAVID: This column is for the trash can icon -->
                            </th>
                          </tr>
                        </thead>
                        <tbody id="group_table_body">

                        </tbody>
                      </table>
                    </div>


                  </div>
                </div>
              </div>
            </div>
            <div class="tab-pane" id="tab_locations">
              <div class="portlet full-height-content full-height-content-scrollable">
                <div class="portlet-title">
                  <div class="actions">
                    <a href="#new_location_modal" data-toggle="modal" class="btn btn-sm green">
                    <i class="fa fa-plus"></i> New </a>
                  </div>
                </div>
                <div class="portlet-body">
                <div class="full-height-content-body" id="height-marker">
                  <div class="row" id="location_portlets">
                    <div class="col-md-3 column" id="location_col">
                      
                    </div>
                    <div class="col-md-9 column">
                      <div id="location_map" class="location_map">
                      </div>
                    </div>
                  </div>
                </div>
                </div>
              </div>
            </div>
            <div class="tab-pane" id="tab_deactivated">
              <div class="portlet full-height-content full-height-content-scrollable">
                <div class="portlet-title">
                  <!--<div class="actions">
                    <a href="#" class="btn btn-sm green">
                    <i class="fa fa-plus"></i> New </a>
                    <div class="btn-group">
                      <a class="btn btn-sm blue" href="#" data-toggle="dropdown">
                      <i class="fa fa-cogs"></i> Tools <i class="fa fa-angle-down"></i>
                      </a>
                      <ul class="dropdown-menu pull-right">
                        <li>
                          <a href="#">
                          <i class="fa fa-trash-o"></i> Delete </a>
                        </li>
                        <li>
                          <a href="#">
                          <i class="fa fa-ban"></i> Ban </a>
                        </li>
                      </ul>
                    </div>
                  </div>-->
                </div>
                <div class="full-height-content-body">
                  <div class="portlet-body">
                    <table class="table table-striped row-bordered table-hover" id="deactivated_table">
                      <thead>
                        <tr>
                          <th class="table-checkbox">
                            <input type="checkbox" class="group-checkable" data-set="#deactivated_table .checkboxes"/>
                          </th>
                          <th>
                          </th>
                          <th>
                             Name
                          </th>
                          <th>
                             Email
                          </th>
                          <th>
                             Phone
                          </th>
                          <th>
                             Group
                          </th>
                          <th>
                             Location
                          </th>
                          <th>
                             Status
                          </th>
                        </tr>
                      </thead>
                      <tbody id="deactivated_table_body">
                      
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>
            <div class="tab-pane" id="tab_network">
            <!-- DAVID: I was working on this -->
              <div class="row">
                <div class="col-lg-7 col-md-7 col-sm-12 col-xs-12">
                  <table id="network_settings_table" style="width: 100%;">
                    <tr>
                      <td>Profanity</td>
                      <td>
                        <input type="checkbox" id="network_settings_profanity_switch" class="make-switch" data-on-text="&nbsp;Enabled&nbsp;&nbsp;" data-off-text="&nbsp;Disabled&nbsp;" />
                      </td>
                    </tr>
                    <tr>
                      <td>Secure Network</td>
                      <td>
                        <!-- Metronic generates the switch functionality when it sees the class "make-switch" -->
                        <input type="checkbox" id="network_settings_secure_network_switch" class="make-switch" data-on-text="&nbsp;Enabled&nbsp;&nbsp;" data-off-text="&nbsp;Disabled&nbsp;" />
                      </td>
                    </tr>
                  </table>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<script src="https://maps.googleapis.com/maps/api/js?v=3.exp&libraries=places"></script>

<!-- DAVID: This next line includes everything in the assets/javascripts/dashboard_groups.js file -->
<%= javascript_include_tag "dashboard_groups" %>

<script>
var UserTable = $('#user_table');
var InviteeTable = $('#invitee_table');
var DeactiveTable = $('#deactivated_table');
var ApplicantTable = $('#applicant_table');
var MassInviteTable = $('#mass_invite_table');
var GroupTable = $('#group_table');

// DOM LOADING TABLE IMPL
var groups_loaded = $.Deferred();

$("#tabs").tabs({
    activate: function( event,ui ) {
        if(ui.newTab.context.hash == "#tab_users") {
          $("#select_all_users").parent().removeClass("checked");
          $("#select_all_users").prop("checked", false);
          $("#user_table_body").find('[type="checkbox"]').each(function() {
              $(this).parent().removeClass("checked");
              $(this).prop("checked", false);
          });
          UserTable.DataTable().columns.adjust().draw();
          Metronic.initUniform();
        } else if(ui.newTab.context.hash == "#tab_applications") {
          ApplicantTable.DataTable().columns.adjust().draw();
          Metronic.initUniform();
        } else if(ui.newTab.context.hash == "#tab_invitations") {
          $("#select_all_invitees").parent().removeClass("checked");
          $("#select_all_invitees").prop("checked", false);
          $("#invitee_table_body").find('[type="checkbox"]').each(function() {
              $(this).parent().removeClass("checked");
              $(this).prop("checked", false);
          });
          InviteeTable.DataTable().columns.adjust().draw();
          Metronic.initUniform();
        } else if(ui.newTab.context.hash == "#tab_groups") {
          
        } else if(ui.newTab.context.hash == "#tab_locations") {
          GroupsModule.initMap();
        } else if(ui.newTab.context.hash == "#tab_deactivated") {
          DeactiveTable.DataTable().columns.adjust().draw();
          Metronic.initUniform();
        } else if(ui.newTab.context.hash == "#tab_network") {
          GroupsModule.networkTabRender();
        }
    }
});


var el = null;
jQuery(document).ready(function() {
  el = $('.main-content-div');
  App.blockUI({
    target: el,
    boxed: true,
    message: 'Loading...',
    overlayColor: '#223A44'
  });
  //App.init();
  Metronic.init(); // init metronic core components
  Layout.init(); // init current layout
  var h = $('#height-marker').parent().height();
  document.getElementById("location_col").style.height = parseInt(h/1.1)+"px";
  document.getElementById("location_col").style.overflowY = "scroll";
  document.getElementById("location_map").style.height = parseInt(h/1.1)+"px";
  QuickSidebar.init(); // init quick sidebar
  Demo.init(); // init demo features
  UIToastr.init();
  UIExtendedModals.init();
  PortletDraggable.init();
  GroupsModule.init();
  FormDropzone.init();

  return $.Deferred(function(def) {

    // resolve the passed def
    // this is the callback when i.e. users_loaded.resolve() is called
    $.when(groups_loaded).done(function() {
      Metronic.initUniform();
      def.resolve();
    });
  });

});
</script>


