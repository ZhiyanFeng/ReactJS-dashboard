'use strict';exports.__esModule=true;var _classCallCheck2=require('babel-runtime/helpers/classCallCheck');var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _possibleConstructorReturn2=require('babel-runtime/helpers/possibleConstructorReturn');var _possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2);var _inherits2=require('babel-runtime/helpers/inherits');var _inherits3=_interopRequireDefault(_inherits2);exports.setupReducers=setupReducers;exports.replaceReducers=replaceReducers;exports.createReduxStore=createReduxStore;exports.default=render;exports.renderHTMLString=renderHTMLString;var _react=require('react');var _react2=_interopRequireDefault(_react);var _reactDom=require('react-dom');var _reactDom2=_interopRequireDefault(_reactDom);var _server=require('react-dom/server');var _server2=_interopRequireDefault(_server);var _reactRouter=require('react-router');var _reactHotLoader=require('react-hot-loader');var _reactRouterScroll=require('@sketchpixy/react-router-scroll');var _reactRouterScroll2=_interopRequireDefault(_reactRouterScroll);var _reactRedux=require('react-redux');var _redux=require('redux');var _reactRouterRedux=require('react-router-redux');var _reduxThunk=require('redux-thunk');var _reduxThunk2=_interopRequireDefault(_reduxThunk);var _reduxFetchData=require('@sketchpixy/redux-fetch-data');var _utils=require('@sketchpixy/redux-fetch-data/lib/utils');var _onRouterSetup=require('./onRouterSetup');var _onRouterSetup2=_interopRequireDefault(_onRouterSetup);var _onRouterUpdate=require('./onRouterUpdate');var _onRouterUpdate2=_interopRequireDefault(_onRouterUpdate);var _checkScroll=require('./checkScroll');var _checkScroll2=_interopRequireDefault(_checkScroll);var _isBrowser=require('../isBrowser');var _isBrowser2=_interopRequireDefault(_isBrowser);var _reduxForm=require('redux-form');var _reduxLogger=require('redux-logger');var _reduxLogger2=_interopRequireDefault(_reduxLogger);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}if((0,_isBrowser2.default)()){(0,_onRouterSetup2.default)();}//import { createStore, combineReducers, applyMiddleware as origApplyMiddleware, compose } from 'redux';
var WrapperComponent=function(_React$Component){(0,_inherits3.default)(WrapperComponent,_React$Component);function WrapperComponent(){(0,_classCallCheck3.default)(this,WrapperComponent);return(0,_possibleConstructorReturn3.default)(this,_React$Component.apply(this,arguments));}WrapperComponent.prototype.render=function render(){return this.props.children;};return WrapperComponent;}(_react2.default.Component);var isRouterSet=false,history,reducer,store,routes;function setupReducers(reducers){reducer=(0,_redux.combineReducers)({userReducer:reducers.userReducer,activeUserReducer:reducers.activeUserReducer,form:_reduxForm.reducer,fetching:_reduxFetchData.reducer,routing:_reactRouterRedux.routerReducer});}function replaceReducers(reducers){setupReducers(reducers);store.replaceReducer(reducer);}function preloadedData(){return document.getElementById('preloadedData');}function getData(){var element=preloadedData();return element?JSON.parse(element.textContent):'';}var middlewares=[_reduxThunk2.default,(0,_reduxLogger2.default)()];//export function applyMiddleware(...args) {
//    if (args.length) {
//        middlewares = middlewares.concat(args);
//    }
//}
function createStoreWithMiddleware(){return(0,_redux.compose)(_redux.applyMiddleware.apply(undefined,middlewares),window.__REDUX_DEVTOOLS_EXTENSION__&&window.__REDUX_DEVTOOLS_EXTENSION__&&(0,_isBrowser2.default)()&&typeof window.devToolsExtension!=='undefined'?window.devToolsExtension():function(f){return f;})(_redux.createStore);}function createReduxStore(initialState){return createStoreWithMiddleware()(reducer,initialState);}function onFetchData(props){// onRouterUpdate();
var container=document.getElementById('container');if(container){container.scrollTop=0;}return _react2.default.createElement(_reduxFetchData.FetchData,props);}function render(Component,onRender){if(!onRender)onRender=function onRender(){};if((0,_isBrowser2.default)()){// in browser
if(!isRouterSet){isRouterSet=true;history=Modernizr.history?_reactRouter.browserHistory:_reactRouter.hashHistory;var initialState=getData();store=createReduxStore(initialState);history=(0,_reactRouterRedux.syncHistoryWithStore)(history,store);routes=_react2.default.createElement(_reactRedux.Provider,{store:store,key:'provider'},_react2.default.createElement(_reactRouter.Router,{history:history,render:onFetchData},Component));}_reactDom2.default.render(_react2.default.createElement(_reactHotLoader.AppContainer,null,_react2.default.createElement(WrapperComponent,null,routes)),document.getElementById('app-container'),onRender);}}function renderHTMLString(routes,req,callback){var store=createReduxStore();// in server
(0,_reactRouter.match)({routes:routes,location:req.url},function(error,redirectLocation,renderProps){if(!renderProps){callback('renderProps not defined!');return;}(0,_reduxFetchData.fetchDataOnServer)(renderProps,store).then(function(){if(error){callback(error);}else if(redirectLocation){callback(null,redirectLocation);}else if(renderProps){callback(null,null,{content:_server2.default.renderToString(_react2.default.createElement(_reactHotLoader.AppContainer,null,_react2.default.createElement(_reactRedux.Provider,{store:store,key:'provider'},_react2.default.createElement(_reactRouter.RouterContext,renderProps)))),data:store.getState()});}else{callback({message:'Not found'});}});});};var _temp=function(){if(typeof __REACT_HOT_LOADER__==='undefined'){return;}__REACT_HOT_LOADER__.register(WrapperComponent,'WrapperComponent','src/node/redux-router.js');__REACT_HOT_LOADER__.register(isRouterSet,'isRouterSet','src/node/redux-router.js');__REACT_HOT_LOADER__.register(history,'history','src/node/redux-router.js');__REACT_HOT_LOADER__.register(reducer,'reducer','src/node/redux-router.js');__REACT_HOT_LOADER__.register(store,'store','src/node/redux-router.js');__REACT_HOT_LOADER__.register(routes,'routes','src/node/redux-router.js');__REACT_HOT_LOADER__.register(setupReducers,'setupReducers','src/node/redux-router.js');__REACT_HOT_LOADER__.register(replaceReducers,'replaceReducers','src/node/redux-router.js');__REACT_HOT_LOADER__.register(preloadedData,'preloadedData','src/node/redux-router.js');__REACT_HOT_LOADER__.register(getData,'getData','src/node/redux-router.js');__REACT_HOT_LOADER__.register(middlewares,'middlewares','src/node/redux-router.js');__REACT_HOT_LOADER__.register(createStoreWithMiddleware,'createStoreWithMiddleware','src/node/redux-router.js');__REACT_HOT_LOADER__.register(createReduxStore,'createReduxStore','src/node/redux-router.js');__REACT_HOT_LOADER__.register(onFetchData,'onFetchData','src/node/redux-router.js');__REACT_HOT_LOADER__.register(render,'render','src/node/redux-router.js');__REACT_HOT_LOADER__.register(renderHTMLString,'renderHTMLString','src/node/redux-router.js');}();;